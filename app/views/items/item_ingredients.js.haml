:plain
  $(document).ready(function(){
    fillAndDisplayModal();
    removeLoadingDimmer();
    changeToggleButton();
    initializeGestures();
  });

  function fillAndDisplayModal() {
    initializeItemIngredientsModal();
    fillModalContent();
    set_the_recipe();
    displayModal();
  }

  function initializeItemIngredientsModal () {
    if ( !$('#ingredientsModal').length ) {
      $('.modal').attr('id', 'ingredientsModal');
      $('.modal').append("#{escape_javascript render 'shared/modal_content', header: nil, content: nil }")
      $('.footer .close').click(function() {
        hideModal();
      });
    }
  }

  function fillModalContent() {
    $('.modal .header').html("INGREDIENTS");
    $('.modal .sub-header .title').html("#{escape_javascript @model.name}");
    $('.modal .content').html("#{escape_javascript render 'items/item_ingredients', item_ingredients: @item_ingredients}");
  }

  function set_the_recipe() {
    $('a.recipe-item').click(function() {
      var button = findRecipeItemShowIngredientsBtn(this);

      hideModal();

      button.trigger('click');
    });
  }

  function findRecipeItemShowIngredientsBtn(recipeItem) {
      var name = $(recipeItem).text();
      var find_item_header_on_page = ("strong:contains(" + name + ")");
      var result = $(find_item_header_on_page);
      return result.parent().find('a');
  }

  function displayModal() {
    $('body').removeClass('dimmed');
    $('#ingredientsModal').modal('show');
  }

  function hideModal() {
    $('#ingredientsModal').modal('hide');
  }

  function removeLoadingDimmer() {
    $('.ui.active.inverted.dimmer').remove();
  }

  function changeToggleButton() {
    revertTogggleButtons();

    var toggleButton = window.remoteRequestButton;
    var text = toggleButton.text().trim();
    var modalItemName = $('.modal .sub-header .title').text();

    if (modalItemName === text) {
      toggleModalButtons(toggleButton, text);
    }
  }

  function toggleModalButtons(remoteRequestButton, name) {
    remoteRequestButton.toggle();

    var existingToggleButton = $( remoteRequestButton.parent().attr('class') + ' .toggle-modal' )

    if (existingToggleButton.val() === undefined) {
      remoteRequestButton.parent().append("<a class='toggle-modal'> " + name + "</a>")
    } else {
      existingToggleButton.show();
    }

    $('.ui.modal')
      .modal('attach events', '.toggle-modal', 'show')
    ;
  }

  function revertTogggleButtons() {
    var modalToggle = $("body").find(".toggle-modal:visible");

    modalToggle.hide();
    modalToggle.parent().find('a.toggle-ingredients').toggle();
  }

  function toggleArrowIcon(element) {
    var openedClassName = 'angle up icon'
    var closedClassName = 'angle down icon'
    var icon = element.getElementsByTagName("i")[0]
    var iconClassName = icon.className

    if ( iconClassName === closedClassName ) {
      icon.className = openedClassName
    } else {
      icon.className = closedClassName
    }
  }

  function initializeGestures() {
    if (window.hammertime !== undefined) { return }

    var modal = document.getElementById('ingredientsModal');
    window.hammertime = new Hammer(modal);

    window.hammertime.on('swipe', function() {
      hideModal();
    });
  }
